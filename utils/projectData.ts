export const projectFiles = {
  "mimetype": "application/vnd.adobe.extension",
  
  "logo.svg": `<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 2500 2500">
  <defs>
    <style>
      .st0 { fill: #282828; }
      .st1 { stroke: #282828; stroke-miterlimit: 10; }
      .st1, .st2 { fill: #ceff00; }
    </style>
  </defs>
  <path class="st2" d="M1910.34,1224.75l-3.18,3.73c76.97-16.92,131.03-30.56,187.61,34.04,47.25,53.95,113.26,178.11,70.84,247.14-37.71,61.36-101.84,52.65-163.85,63.55-47.01,8.26-92.42,22.11-138.67,33.3l26.05,40.71c38.78,63.28,28.69,183.38-42.24,220.23-41.91,21.77-108.11,15.89-155.76,20.47-241.66,23.22-494.08,81.25-717.65,174.87-84.79,35.5-164.96,82.46-251.68,112.15-87.12,9.56-189.06-82.24-176.88-171.2,4.03-29.46,21.74-47.62,33.36-73.21-1.71-1.66-38.65,14.43-44.84,16.24-183.05,53.48-359.82-138.3-370.11-310.48-12.77-213.75,103.32-502.4,226.26-674.74,54.21-75.99,173.14-210.56,264.86-232.56,44.19-10.6,80.39,9.46,116.91,32.09,45.64,28.29,87.27,71.14,113.98,117.71l5.62-1.83c49.09-127.58,201.83-74.95,272.85,1.84,11.41-47.24,47.75-65.54,88.24-83.75,65.15-29.31,163.13-63.58,232.96-76.87,20.72-3.94,39.92-1.59,57.63-4.9,25.94-4.85,76.29-30.04,105.07-39.9,68.04-23.3,237.32-86.09,301.76-78.51,53.35,6.28,112.48,104.39,137.66,149.43,29.14,52.14,44.88,86.03,18.06,144.96-65.63,111.33-135.54,220.76-194.84,335.47Z"/>
  <path class="st2" d="M1920.74,1279.31c-16.42,0-30.62-4.39-42.44-13.13-18.03-13.34-27.79-34.67-29.02-63.37-1.29-30.13,20.26-57.38,42.43-82.7l2.19-2.5c41.85-48.05,106.19-103.72,167.91-145.28,1.15-.77,116.43-77.32,173.96-77.32h.12c20.32.04,35.02,10.18,43.8,16.24,13.13,9.06,65.73,59.03,69.22,100.14,1.33,15.66-3.77,29.98-14.36,40.32-7.37,7.19-12.02,9.25-71.21,31.47-15.29,5.74-32.62,12.25-37.4,14.37-80.34,35.68-145.75,84.45-215.01,136.09-15.6,11.63-31.73,23.66-48.18,35.65l-5.75,4.19-6.89,1.79c-10.45,2.71-20.25,4.06-29.37,4.06Z"/>
  <path class="st0" d="M2235.81,932.4c8.7.02,15.85,4.95,22.63,9.62,14.86,10.26,66.72,66.55,49.97,82.9-3.75,3.67-83.16,31.98-97.66,38.42-102.8,45.66-180.23,110.25-270.04,175.7-34.18,8.87-52.56-2.4-54.07-37.83-.8-18.79,23.26-45.04,35.46-59.04,42.63-48.95,106.66-102.51,160.6-138.82,30.96-20.85,117.85-71,153.12-70.94Z"/>
  <path class="st0" d="M1817.6,1290.95c64.83-7.46,129.08-24.66,194.46-25.31,38.66,5.13,71.2,52.43,89.23,84.17,36.19,63.72,64.88,159.2-38.17,171.06-10.29,1.18-21.14-.9-30.88.38-100.16,13.18-201.6,50.49-299.89,73.91-.83,3.69,2.94,3.39,5.64,4.2,41.29,12.49,66.01,12.48,96.58,48.43,28.69,33.74,37.6,69.12,30.61,112.88-15.25,95.5-96.88,75.72-168.37,81.76-261.62,22.11-548.94,93.53-787.87,201.3-45.14,20.36-88.58,44.79-133.49,65.48-29.64,13.65-55.73,32.48-88.25,20.83-50.72-18.16-95.03-54.94-94.94-112.8.06-38.14,45.07-70.72,72.58-92.43,2.7-2.13,1.44-2.31-1.32-4.17-8.98-6.06-24.3-9.58-34.98-16.19-17.76-11-28.83-28.47-46.13-39.44-30.59,11.31-54.13,41.22-88.28,45.31-116.48,13.94-235.11-94.88-268.12-200.25-54.52-174.06,50.73-473.69,138.62-628.49,56.12-98.85,153.92-235,256.19-286.71,105.73-53.46,196.87,53.3,246.85,134.26,9.97,16.15,17.57,50.81,44,42.95,18.15-5.4,18.35-60.65,23.93-78.47,25.44-81.21,148.82-31.59,189.98,10.69,16.11,16.55,36.93,81.43,69.37,55.38,24.44-19.63-5.51-77.53,42.64-105.17,17.67-10.14,48.39-20.35,68.42-28.23,51.67-20.34,152.91-58.1,205.93-61.24,23.84-1.41,21.29,4.86,43.47-4.9,36.69-16.14,76.97-28.46,115.05-41.26,70.8-23.81,163.41-57.47,235.18-71.78,72.31-14.41,110.61,62.48,141.66,117.15,30.11,53.01,35.55,63.37,6.72,119.33-43.76,84.94-103.28,171.25-151.63,254.84-29.1,50.3-57.08,101.47-84.78,152.53Z"/>
  <path class="st1" d="M396.42,1728.71c2.17,1.65,33.15-19.92,37.8-23.26,66.37-47.6,136.1-134.76,179.37-204.36,14.75-23.73,26.78-54.73,41.9-77.48,4.74-7.14,23.33-24.82,25.1-28.93,1.49-3.48-.63-5.35-4.18-4.18-27.08,8.82-61.1,37.16-86.67,44.1-9.55,2.59-16.69,2.15-24.29-4.3-10.55-8.96-43.75-70.47-44.15-84.01-.46-15.07,9.3-20.95,20.97-27.39,64.77-35.74,186.35-85.63,257.76-103.23,10.2-2.52,26.28-9.32,33.79.27,14.64,18.71,20.2,50.08,17.04,73.3-58.66,183.07-102.87,370.51-126.07,561.81-4.61,11.06-13.76,15.16-25.37,13.97-10.36-1.06-65.42-18.27-72.7-24.15-10.15-8.2-14.67-29.83-14.56-42.52.05-5.99,2.94-11.62,3.05-17.09.77-37.87,2.71-72.28,11.37-109.4-68.92,79.97-143.36,210.53-266.94,137.63-150.79-88.95-107.85-299.11-67.01-438.92,45.61-156.13,125.52-322.93,235.87-443.47,34.22-37.39,118.09-108.56,171.49-94.67,24.32,6.33,41.68,30.72,58.72,46.45,13,12,30.2,15.57,34.95,38.95,10.4,51.2-15.78,145.08-40.93,190.87-6.84,12.46-14.43,29.82-32.29,21.61-8.08-3.72-45.62-41.65-45.34-54.16l14.04-93.54-12.7-12.83c-26.71,34.85-54.92,68.38-81.6,103.27-102.15,133.6-169.18,284.67-202.79,450.97-13.29,65.78-24.14,141.89,4.33,204.68Z"/>
  <path class="st1" d="M1666.98,1384.78c94.22-32.92,192.51-57.72,291.79-70.59,18.98-2.46,41-8.48,57.91,3.68,16.12,11.6,56.51,88.33,49,105.95-2.79,6.55-13.22,10.13-19.93,11.45-29.77,5.87-64.04,7.26-95.08,12.93-124.87,22.82-250.15,60.01-367.66,107.23-10.63.62-13.42-1.34-21.28-7.16-13.02-9.66-56.26-54.23-58.96-68.93-4.58-24.94,16.55-67.57,26.42-91.64,32.33-78.86,73.46-160.76,113.55-236.07,54.1-101.65,113.43-205.82,183.38-296.99l-177.56,49.71c-13.79-2.68-31.09-44.48-39-57.67-9.4-15.69-21.14-30.04-30.59-45.7,4.45-6.88,11.97-9.42,19.02-12.43,44.37-19,104.8-34.92,152.05-49.76,48.61-15.27,106.27-35.92,155.07-46.73,17.93-3.97,24.1-6.36,39.09,7.58,12.52,11.64,51.34,71.8,54.68,87.44,1.12,5.25,1.45,10.5-.04,15.74-26.88,44.53-57.37,87.38-84.1,131.93-74.26,123.8-152.32,256.17-218.07,384.53-10.86,21.2-21.41,43.12-29.69,65.5Z"/>
  <path class="st1" d="M1351.47,1117.59l105.93-42.23c21.52,14.86,49.28,52.98,44.04,80.06-1.82,9.41-23.91,22.02-32.86,26.73-44.35,23.35-98.56,33.93-142.89,58.92-21.8,60.75-35.33,123.86-50.97,186.34l171.87-84.95c24.43-.58,46.72,62.62,40.69,82.96-2.05,6.91-23.04,22.07-29.78,27.05-65.34,48.27-141.45,87.43-205.73,138.2-25.19,12.68-33.22,8.45-53.86-8.31-17.82-14.47-47.05-43.25-50.39-66.15-6.08-41.72,16.9-124.34,26.23-168.42,13.43-63.5,28.12-127.15,42.64-190.44,9.19-40.06,47.17-162.66,43.35-193.94-2.22-18.2-20.4-44.07-16.42-59.94.52-2.07,32.83-17.03,37.98-19.46,73.68-34.71,153.91-55.43,232.95-72.98,11.67,3.08,42.35,66.2,45.62,79.71,1.22,5.04,3.28,8.2.61,13.65-8.27,16.85-147.69,54.7-170.6,71.13l-38.4,142.07Z"/>
  <path class="st2" d="M647.5,2046.09c-26-28.19,5.39-54.18,26.09-72.84,161.52-145.67,498.37-254.63,711.43-291.95,96.92-16.98,240.88-38.44,337.49-32.3,38.84,2.47,84.89,15.81,83.44,63.83-1.61,53.38-76.64,43.93-111.97,47.19-325.93,30.12-645.53,102.16-935.68,255.3-17.71,9.35-56.62,37.19-71.85,41.83-14.42,4.39-29.02-.29-38.95-11.06Z"/>
  <path class="st1" d="M956.37,1541.12c29.25-17.13,56.68-37.76,86.18-54.49,13.06-7.41,50.98-29.94,63.58-29.98,24.23-.08,45.18,57.7,36.34,78.74-4.45,10.6-83.52,62.06-99.35,74.04-26.22,19.84-50.24,43.24-77.35,61.93-15.26,10.52-45.42,33.59-63.58,27.7-9.21-2.98-59.96-51.86-66.45-61.48-4.15-6.14-9.01-17.59-9.56-24.8-1.58-20.48,12.62-77.04,17.32-100.66,20.99-105.64,44.69-212.81,68.78-317.79,11.93-51.99,31.16-102.13,42.76-153.37,8.79-38.83,10.77-84.55,20.21-121.91,9.2-36.39,36.51-23.61,62.62-12.28,18.27,7.93,54.84,27.94,54.93,50.2-36.07,196.93-95,388.59-136.41,584.16Z"/>
  <g>
    <g>
      <path class="st2" d="M1427.5,320.5c-44.01-4.4-114.06,16.58-157.32,29.14-137.71,39.97-282.83,103.94-406.56,176.04-14.56,8.49-76.31,43.71-83.11,52.84-12.01,16.13,17.91,54.42,32.4,52.21,8.95-1.36,56.79-35.37,70.13-42.91,9.72-5.49,68-37.62,72.52-34.25l-46.93,207.78c-6.99,15.57,38.16,57.08,46.91,48.54l60.33-287.33c92.43-47.97,191.99-86.92,292.3-115.52,37.38-10.66,108.94-20.3,139.57-35.21,33.77-16.44,15.55-47.76-20.24-51.33Z"/>
      <path class="st2" d="M1181.76,500.01l-22.12,111.94c-2.23,3.51-47.09,14.26-54.71,15.27-6.27.83-6.3.88-5.1-5.1,8.36-41.34,41.73-105.77-31.25-95.38l-42.79,207.99c-5.19,29.82,31.01,41.98,54.04,47.94l11.93-94.88,57.98-17.71c-5.58,43.43-16.35,88.96,42.38,92.85l37.4-244.22c-11.89-14.31-29.09-26.75-47.77-18.69Z"/>
      <path class="st2" d="M1380.81,460.07c-13.91-.95-103.66,26.47-108.74,35.15-6.65,43.04-20.37,84.6-27.94,127.42-3.6,20.34-13.02,66.72-12.88,84.45.11,14.64,26.27,51.86,43.75,47.77l130.53-54.3c4.6-13.88-6.56-35.84-21.32-37.32-14.41-1.44-90.69,37.98-98.47,30.11-.09-3.22-.24-6.48-.15-9.74.18-6.65,6.12-40.53,8.8-43.71,8.15-9.66,83.33-20.56,87.93-34.6,3.32-14.8-5.37-28.32-17.77-35.64l-59.37,18.82,13.68-62.02c28.76-16.26,62.56-18.27,94.17-24.23,11.96-21.54-11-40.73-32.21-42.17Z"/>
    </g>
    <g>
      <path class="st0" d="M1427.5,320.5c-44.01-4.4-114.06,16.58-157.32,29.14-137.71,39.97-282.83,103.94-406.56,176.04-14.56,8.49-76.31,43.71-83.11,52.84-12.01,16.13,17.91,54.42,32.4,52.21,8.95-1.36,56.79-35.37,70.13-42.91,9.72-5.49,68-37.62,72.52-34.25l-46.93,207.78c-6.99,15.57,38.16,57.08,46.91,48.54l60.33-287.33c92.43-47.97,191.99-86.92,292.3-115.52,37.38-10.66,108.94-20.3,139.57-35.21,33.77-16.44,15.55-47.76-20.24-51.33Z"/>
      <path class="st0" d="M1181.76,500.01l-22.12,111.94c-2.23,3.51-47.09,14.26-54.71,15.27-6.27.83-6.3.88-5.1-5.1,8.36-41.34,41.73-105.77-31.25-95.38l-42.79,207.99c-5.19,29.82,31.01,41.98,54.04,47.94l11.93-94.88,57.98-17.71c-5.58,43.43-16.35,88.96,42.38,92.85l37.4-244.22c-11.89-14.31-29.09-26.75-47.77-18.69Z"/>
      <path class="st0" d="M1380.81,460.07c-13.91-.95-103.66,26.47-108.74,35.15-6.65,43.04-20.37,84.6-27.94,127.42-3.6,20.34-13.02,66.72-12.88,84.45.11,14.64,26.27,51.86,43.75,47.77l130.53-54.3c4.6-13.88-6.56-35.84-21.32-37.32-14.41-1.44-90.69,37.98-98.47,30.11-.09-3.22-.24-6.48-.15-9.74.18-6.65,6.12-40.53,8.8-43.71,8.15-9.66,83.33-20.56,87.93-34.6,3.32-14.8-5.37-28.32-17.77-35.64l-59.37,18.82,13.68-62.02c28.76-16.26,62.56-18.27,94.17-24.23,11.96-21.54-11-40.73-32.21-42.17Z"/>
    </g>
  </g>
</svg>`,

  "CSXS/manifest.xml": `<?xml version="1.0" encoding="UTF-8"?>
<ExtensionManifest Version="9.0" ExtensionBundleId="com.theglez.toolkit" ExtensionBundleVersion="1.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <ExtensionList>
    <Extension Id="com.theglez.toolkit.panel" Version="1.0.0" />
  </ExtensionList>
  <ExecutionEnvironment>
    <HostList>
      <Host Name="AEFT" Version="[14.0,99.9]" />
    </HostList>
    <LocaleList>
      <Locale Code="All" />
    </LocaleList>
    <RequiredRuntimeList>
      <RequiredRuntime Name="CSXS" Version="9.0" />
    </RequiredRuntimeList>
  </ExecutionEnvironment>
  <DispatchInfoList>
    <Extension Id="com.theglez.toolkit.panel">
      <DispatchInfo >
        <Resources>
          <MainPath>./index.html</MainPath>
          <ScriptPath>./host/index.jsx</ScriptPath>
          <CEFCommandLine>
            <Parameter>--enable-nodejs</Parameter>
            <Parameter>--mixed-context</Parameter>
            <Parameter>--enable-media-stream</Parameter>
            <Parameter>--disable-web-security</Parameter>
          </CEFCommandLine>
        </Resources>
        <Lifecycle>
          <AutoVisible>true</AutoVisible>
        </Lifecycle>
        <UI>
          <Type>Panel</Type>
          <Menu>ToolKit - By The Glez</Menu>
          <Geometry>
            <Size>
              <Height>600</Height>
              <Width>400</Width>
            </Size>
            <MinSize>
              <Height>300</Height>
              <Width>300</Width>
            </MinSize>
          </Geometry>
        </UI>
      </DispatchInfo>
    </Extension>
  </DispatchInfoList>
</ExtensionManifest>`,

  "index.html": `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://unpkg.com https://cdnjs.cloudflare.com data:;">
    <title>ToolKit - By The Glez</title>
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              glez: { dark: '#18181b', card: '#27272a', lime: '#ccff00', limeHover: '#b3e600' }
            },
            fontFamily: { sans: ['Inter', 'sans-serif'] }
          }
        }
      }
    </script>

    <!-- React UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-glez-dark text-white overflow-hidden">
    <div id="root"></div>

    <!-- CSInterface Shim -->
    <script>
      (function(){var n=function(){};n.prototype.getHostEnvironment=function(){return JSON.parse(window.__adobe_cep__.getHostEnvironment())},n.prototype.closeExtension=function(){window.__adobe_cep__.closeExtension()},n.prototype.getSystemPath=function(n){var e=decodeURIComponent(window.__adobe_cep__.getSystemPath(n)),t=navigator.platform.toLowerCase().indexOf("win")>-1;return t?e.replace(/^file:\\/\\//,""):e.replace(/^file:\\/\\//,"/")},n.prototype.evalScript=function(n,e){null==e&&(e=function(n){}),window.__adobe_cep__.evalScript(n,e)},n.prototype.openURLInDefaultBrowser=function(n){return window.__adobe_cep__.openURLInDefaultBrowser(n)},window.CSInterface=n})();
      if (typeof window.__adobe_cep__ === 'undefined') {
        window.CSInterface = function() {};
        window.CSInterface.prototype.evalScript = function(s) { console.log("[AE Call]", s); };
        window.CSInterface.prototype.openURLInDefaultBrowser = function(u) { window.open(u, '_blank'); };
        window.CSInterface.prototype.getSystemPath = function() { return ""; };
      }
      
      window.onerror = function(msg, url, line) {
        // Suppress benign resize errors often seen in CEP
        if (msg && msg.indexOf("ResizeObserver") > -1) return;
        alert("UI Error: " + msg + "\\nLine: " + line);
      };
    </script>

    <!-- React App -->
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // Icons
        const ZapIcon = ({size, fill, className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill || "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        );
        const InfoIcon = ({size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        );
        const TypeIcon = ({size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>
        );
        const MaximizeIcon = ({size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>
        );
        const Trash2Icon = ({size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
        );
        const PenToolIcon = ({size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>
        );
        const FolderInputIcon = ({size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2"/><path d="M12 13v8"/><path d="m9 16 3-3 3 3"/></svg>
        );
        const PaletteIcon = ({size}) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>
        );

        const runAeScript = (functionName) => {
          try {
            const csInterface = new window.CSInterface();
            
            // 1. Get Extension Path safely
            var extPath = csInterface.getSystemPath('extension');
            if (!extPath) { 
                console.log("Mock executing: " + functionName);
                return; 
            }

            // 2. Decode & Normalize Slashes
            extPath = decodeURIComponent(extPath);
            var cleanPath = extPath.split("\\\\").join("/");
            
            if (cleanPath.indexOf("file://") === 0) {
                cleanPath = cleanPath.substring(7);
            }
            if (/^\\/[a-zA-Z]:\\//.test(cleanPath)) {
                cleanPath = cleanPath.substring(1);
            }

            // 3. Robust Command Construction using Concatenation
            var scriptPath = cleanPath + "/host/index.jsx";
            
            var cmd = "try { ";
            cmd += "var f = new File('" + scriptPath + "'); ";
            cmd += "if (typeof $._TheGlez === 'undefined') { ";
            cmd +=     "if (f.exists) { $.evalFile(f); } ";
            cmd +=     "else { alert('Host script missing: ' + f.fsName); } ";
            cmd += "} ";
            cmd += "if (typeof $._TheGlez !== 'undefined' && typeof $._TheGlez['" + functionName + "'] === 'function') { ";
            cmd +=     "$._TheGlez['" + functionName + "'](); ";
            cmd += "} else { ";
            cmd +=     "alert('Function " + functionName + " not found.'); ";
            cmd += "} ";
            cmd += "} catch(e) { alert('Exec Error: ' + e.toString()); }";

            csInterface.evalScript(cmd);
          } catch(e) { alert("Interface Error: " + e.message); }
        };

        const tools = [
          { id: 'subtitle-pro', name: 'Subtitle Pro', description: 'Create subs from SRT.', icon: TypeIcon, functionName: 'runSubtitlePro' },
          { id: 'resize-comp', name: 'Resize Comp', description: 'Crop comp to layer.', icon: MaximizeIcon, functionName: 'runResizeComp' },
          { id: 'unused-cleaner', name: 'Clean Unused', description: 'Delete unused items.', icon: Trash2Icon, functionName: 'runUnusedCleaner' },
          { id: 'layer-renamer', name: 'Renamer', description: 'Batch rename layers.', icon: PenToolIcon, functionName: 'runRenamer' },
          { id: 'project-organizer', name: 'Organizer', description: 'Sort into folders.', icon: FolderInputIcon, functionName: 'runOrganizer' },
          { id: 'auto-type-color', name: 'Auto Color', description: 'Label by type.', icon: PaletteIcon, functionName: 'runAutoColor' }
        ];

        const App = () => {
          const [hoveredId, setHoveredId] = useState(null);
          
          // Embed the official vector logo
          const logoSrc = "data:image/svg+xml;base64," + btoa(unescape(encodeURIComponent(\`<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 2500 2500">
  <defs>
    <style>
      .st0 { fill: #282828; }
      .st1 { stroke: #282828; stroke-miterlimit: 10; }
      .st1, .st2 { fill: #ceff00; }
    </style>
  </defs>
  <path class="st2" d="M1910.34,1224.75l-3.18,3.73c76.97-16.92,131.03-30.56,187.61,34.04,47.25,53.95,113.26,178.11,70.84,247.14-37.71,61.36-101.84,52.65-163.85,63.55-47.01,8.26-92.42,22.11-138.67,33.3l26.05,40.71c38.78,63.28,28.69,183.38-42.24,220.23-41.91,21.77-108.11,15.89-155.76,20.47-241.66,23.22-494.08,81.25-717.65,174.87-84.79,35.5-164.96,82.46-251.68,112.15-87.12,9.56-189.06-82.24-176.88-171.2,4.03-29.46,21.74-47.62,33.36-73.21-1.71-1.66-38.65,14.43-44.84,16.24-183.05,53.48-359.82-138.3-370.11-310.48-12.77-213.75,103.32-502.4,226.26-674.74,54.21-75.99,173.14-210.56,264.86-232.56,44.19-10.6,80.39,9.46,116.91,32.09,45.64,28.29,87.27,71.14,113.98,117.71l5.62-1.83c49.09-127.58,201.83-74.95,272.85,1.84,11.41-47.24,47.75-65.54,88.24-83.75,65.15-29.31,163.13-63.58,232.96-76.87,20.72-3.94,39.92-1.59,57.63-4.9,25.94-4.85,76.29-30.04,105.07-39.9,68.04-23.3,237.32-86.09,301.76-78.51,53.35,6.28,112.48,104.39,137.66,149.43,29.14,52.14,44.88,86.03,18.06,144.96-65.63,111.33-135.54,220.76-194.84,335.47Z"/>
  <path class="st2" d="M1920.74,1279.31c-16.42,0-30.62-4.39-42.44-13.13-18.03-13.34-27.79-34.67-29.02-63.37-1.29-30.13,20.26-57.38,42.43-82.7l2.19-2.5c41.85-48.05,106.19-103.72,167.91-145.28,1.15-.77,116.43-77.32,173.96-77.32h.12c20.32.04,35.02,10.18,43.8,16.24,13.13,9.06,65.73,59.03,69.22,100.14,1.33,15.66-3.77,29.98-14.36,40.32-7.37,7.19-12.02,9.25-71.21,31.47-15.29,5.74-32.62,12.25-37.4,14.37-80.34,35.68-145.75,84.45-215.01,136.09-15.6,11.63-31.73,23.66-48.18,35.65l-5.75,4.19-6.89,1.79c-10.45,2.71-20.25,4.06-29.37,4.06Z"/>
  <path class="st0" d="M2235.81,932.4c8.7.02,15.85,4.95,22.63,9.62,14.86,10.26,66.72,66.55,49.97,82.9-3.75,3.67-83.16,31.98-97.66,38.42-102.8,45.66-180.23,110.25-270.04,175.7-34.18,8.87-52.56-2.4-54.07-37.83-.8-18.79,23.26-45.04,35.46-59.04,42.63-48.95,106.66-102.51,160.6-138.82,30.96-20.85,117.85-71,153.12-70.94Z"/>
  <path class="st0" d="M1817.6,1290.95c64.83-7.46,129.08-24.66,194.46-25.31,38.66,5.13,71.2,52.43,89.23,84.17,36.19,63.72,64.88,159.2-38.17,171.06-10.29,1.18-21.14-.9-30.88.38-100.16,13.18-201.6,50.49-299.89,73.91-.83,3.69,2.94,3.39,5.64,4.2,41.29,12.49,66.01,12.48,96.58,48.43,28.69,33.74,37.6,69.12,30.61,112.88-15.25,95.5-96.88,75.72-168.37,81.76-261.62,22.11-548.94,93.53-787.87,201.3-45.14,20.36-88.58,44.79-133.49,65.48-29.64,13.65-55.73,32.48-88.25,20.83-50.72-18.16-95.03-54.94-94.94-112.8.06-38.14,45.07-70.72,72.58-92.43,2.7-2.13,1.44-2.31-1.32-4.17-8.98-6.06-24.3-9.58-34.98-16.19-17.76-11-28.83-28.47-46.13-39.44-30.59,11.31-54.13,41.22-88.28,45.31-116.48,13.94-235.11-94.88-268.12-200.25-54.52-174.06,50.73-473.69,138.62-628.49,56.12-98.85,153.92-235,256.19-286.71,105.73-53.46,196.87,53.3,246.85,134.26,9.97,16.15,17.57,50.81,44,42.95,18.15-5.4,18.35-60.65,23.93-78.47,25.44-81.21,148.82-31.59,189.98,10.69,16.11,16.55,36.93,81.43,69.37,55.38,24.44-19.63-5.51-77.53,42.64-105.17,17.67-10.14,48.39-20.35,68.42-28.23,51.67-20.34,152.91-58.1,205.93-61.24,23.84-1.41,21.29,4.86,43.47-4.9,36.69-16.14,76.97-28.46,115.05-41.26,70.8-23.81,163.41-57.47,235.18-71.78,72.31-14.41,110.61,62.48,141.66,117.15,30.11,53.01,35.55,63.37,6.72,119.33-43.76,84.94-103.28,171.25-151.63,254.84-29.1,50.3-57.08,101.47-84.78,152.53Z"/>
  <path class="st1" d="M396.42,1728.71c2.17,1.65,33.15-19.92,37.8-23.26,66.37-47.6,136.1-134.76,179.37-204.36,14.75-23.73,26.78-54.73,41.9-77.48,4.74-7.14,23.33-24.82,25.1-28.93,1.49-3.48-.63-5.35-4.18-4.18-27.08,8.82-61.1,37.16-86.67,44.1-9.55,2.59-16.69,2.15-24.29-4.3-10.55-8.96-43.75-70.47-44.15-84.01-.46-15.07,9.3-20.95,20.97-27.39,64.77-35.74,186.35-85.63,257.76-103.23,10.2-2.52,26.28-9.32,33.79.27,14.64,18.71,20.2,50.08,17.04,73.3-58.66,183.07-102.87,370.51-126.07,561.81-4.61,11.06-13.76,15.16-25.37,13.97-10.36-1.06-65.42-18.27-72.7-24.15-10.15-8.2-14.67-29.83-14.56-42.52.05-5.99,2.94-11.62,3.05-17.09.77-37.87,2.71-72.28,11.37-109.4-68.92,79.97-143.36,210.53-266.94,137.63-150.79-88.95-107.85-299.11-67.01-438.92,45.61-156.13,125.52-322.93,235.87-443.47,34.22-37.39,118.09-108.56,171.49-94.67,24.32,6.33,41.68,30.72,58.72,46.45,13,12,30.2,15.57,34.95,38.95,10.4,51.2-15.78,145.08-40.93,190.87-6.84,12.46-14.43,29.82-32.29,21.61-8.08-3.72-45.62-41.65-45.34-54.16l14.04-93.54-12.7-12.83c-26.71,34.85-54.92,68.38-81.6,103.27-102.15,133.6-169.18,284.67-202.79,450.97-13.29,65.78-24.14,141.89,4.33,204.68Z"/>
  <path class="st1" d="M1666.98,1384.78c94.22-32.92,192.51-57.72,291.79-70.59,18.98-2.46,41-8.48,57.91,3.68,16.12,11.6,56.51,88.33,49,105.95-2.79,6.55-13.22,10.13-19.93,11.45-29.77,5.87-64.04,7.26-95.08,12.93-124.87,22.82-250.15,60.01-367.66,107.23-10.63.62-13.42-1.34-21.28-7.16-13.02-9.66-56.26-54.23-58.96-68.93-4.58-24.94,16.55-67.57,26.42-91.64,32.33-78.86,73.46-160.76,113.55-236.07,54.1-101.65,113.43-205.82,183.38-296.99l-177.56,49.71c-13.79-2.68-31.09-44.48-39-57.67-9.4-15.69-21.14-30.04-30.59-45.7,4.45-6.88,11.97-9.42,19.02-12.43,44.37-19,104.8-34.92,152.05-49.76,48.61-15.27,106.27-35.92,155.07-46.73,17.93-3.97,24.1-6.36,39.09,7.58,12.52,11.64,51.34,71.8,54.68,87.44,1.12,5.25,1.45,10.5-.04,15.74-26.88,44.53-57.37,87.38-84.1,131.93-74.26,123.8-152.32,256.17-218.07,384.53-10.86,21.2-21.41,43.12-29.69,65.5Z"/>
  <path class="st1" d="M1351.47,1117.59l105.93-42.23c21.52,14.86,49.28,52.98,44.04,80.06-1.82,9.41-23.91,22.02-32.86,26.73-44.35,23.35-98.56,33.93-142.89,58.92-21.8,60.75-35.33,123.86-50.97,186.34l171.87-84.95c24.43-.58,46.72,62.62,40.69,82.96-2.05,6.91-23.04,22.07-29.78,27.05-65.34,48.27-141.45,87.43-205.73,138.2-25.19,12.68-33.22,8.45-53.86-8.31-17.82-14.47-47.05-43.25-50.39-66.15-6.08-41.72,16.9-124.34,26.23-168.42,13.43-63.5,28.12-127.15,42.64-190.44,9.19-40.06,47.17-162.66,43.35-193.94-2.22-18.2-20.4-44.07-16.42-59.94.52-2.07,32.83-17.03,37.98-19.46,73.68-34.71,153.91-55.43,232.95-72.98,11.67,3.08,42.35,66.2,45.62,79.71,1.22,5.04,3.28,8.2.61,13.65-8.27,16.85-147.69,54.7-170.6,71.13l-38.4,142.07Z"/>
  <path class="st2" d="M647.5,2046.09c-26-28.19,5.39-54.18,26.09-72.84,161.52-145.67,498.37-254.63,711.43-291.95,96.92-16.98,240.88-38.44,337.49-32.3,38.84,2.47,84.89,15.81,83.44,63.83-1.61,53.38-76.64,43.93-111.97,47.19-325.93,30.12-645.53,102.16-935.68,255.3-17.71,9.35-56.62,37.19-71.85,41.83-14.42,4.39-29.02-.29-38.95-11.06Z"/>
  <path class="st1" d="M956.37,1541.12c29.25-17.13,56.68-37.76,86.18-54.49,13.06-7.41,50.98-29.94,63.58-29.98,24.23-.08,45.18,57.7,36.34,78.74-4.45,10.6-83.52,62.06-99.35,74.04-26.22,19.84-50.24,43.24-77.35,61.93-15.26,10.52-45.42,33.59-63.58,27.7-9.21-2.98-59.96-51.86-66.45-61.48-4.15-6.14-9.01-17.59-9.56-24.8-1.58-20.48,12.62-77.04,17.32-100.66,20.99-105.64,44.69-212.81,68.78-317.79,11.93-51.99,31.16-102.13,42.76-153.37,8.79-38.83,10.77-84.55,20.21-121.91,9.2-36.39,36.51-23.61,62.62-12.28,18.27,7.93,54.84,27.94,54.93,50.2-36.07,196.93-95,388.59-136.41,584.16Z"/>
  <g>
    <g>
      <path class="st2" d="M1427.5,320.5c-44.01-4.4-114.06,16.58-157.32,29.14-137.71,39.97-282.83,103.94-406.56,176.04-14.56,8.49-76.31,43.71-83.11,52.84-12.01,16.13,17.91,54.42,32.4,52.21,8.95-1.36,56.79-35.37,70.13-42.91,9.72-5.49,68-37.62,72.52-34.25l-46.93,207.78c-6.99,15.57,38.16,57.08,46.91,48.54l60.33-287.33c92.43-47.97,191.99-86.92,292.3-115.52,37.38-10.66,108.94-20.3,139.57-35.21,33.77-16.44,15.55-47.76-20.24-51.33Z"/>
      <path class="st2" d="M1181.76,500.01l-22.12,111.94c-2.23,3.51-47.09,14.26-54.71,15.27-6.27.83-6.3.88-5.1-5.1,8.36-41.34,41.73-105.77-31.25-95.38l-42.79,207.99c-5.19,29.82,31.01,41.98,54.04,47.94l11.93-94.88,57.98-17.71c-5.58,43.43-16.35,88.96,42.38,92.85l37.4-244.22c-11.89-14.31-29.09-26.75-47.77-18.69Z"/>
      <path class="st2" d="M1380.81,460.07c-13.91-.95-103.66,26.47-108.74,35.15-6.65,43.04-20.37,84.6-27.94,127.42-3.6,20.34-13.02,66.72-12.88,84.45.11,14.64,26.27,51.86,43.75,47.77l130.53-54.3c4.6-13.88-6.56-35.84-21.32-37.32-14.41-1.44-90.69,37.98-98.47,30.11-.09-3.22-.24-6.48-.15-9.74.18-6.65,6.12-40.53,8.8-43.71,8.15-9.66,83.33-20.56,87.93-34.6,3.32-14.8-5.37-28.32-17.77-35.64l-59.37,18.82,13.68-62.02c28.76-16.26,62.56-18.27,94.17-24.23,11.96-21.54-11-40.73-32.21-42.17Z"/>
    </g>
    <g>
      <path class="st0" d="M1427.5,320.5c-44.01-4.4-114.06,16.58-157.32,29.14-137.71,39.97-282.83,103.94-406.56,176.04-14.56,8.49-76.31,43.71-83.11,52.84-12.01,16.13,17.91,54.42,32.4,52.21,8.95-1.36,56.79-35.37,70.13-42.91,9.72-5.49,68-37.62,72.52-34.25l-46.93,207.78c-6.99,15.57,38.16,57.08,46.91,48.54l60.33-287.33c92.43-47.97,191.99-86.92,292.3-115.52,37.38-10.66,108.94-20.3,139.57-35.21,33.77-16.44,15.55-47.76-20.24-51.33Z"/>
      <path class="st0" d="M1181.76,500.01l-22.12,111.94c-2.23,3.51-47.09,14.26-54.71,15.27-6.27.83-6.3.88-5.1-5.1,8.36-41.34,41.73-105.77-31.25-95.38l-42.79,207.99c-5.19,29.82,31.01,41.98,54.04,47.94l11.93-94.88,57.98-17.71c-5.58,43.43-16.35,88.96,42.38,92.85l37.4-244.22c-11.89-14.31-29.09-26.75-47.77-18.69Z"/>
      <path class="st0" d="M1380.81,460.07c-13.91-.95-103.66,26.47-108.74,35.15-6.65,43.04-20.37,84.6-27.94,127.42-3.6,20.34-13.02,66.72-12.88,84.45.11,14.64,26.27,51.86,43.75,47.77l130.53-54.3c4.6-13.88-6.56-35.84-21.32-37.32-14.41-1.44-90.69,37.98-98.47,30.11-.09-3.22-.24-6.48-.15-9.74.18-6.65,6.12-40.53,8.8-43.71,8.15-9.66,83.33-20.56,87.93-34.6,3.32-14.8-5.37-28.32-17.77-35.64l-59.37,18.82,13.68-62.02c28.76-16.26,62.56-18.27,94.17-24.23,11.96-21.54-11-40.73-32.21-42.17Z"/>
    </g>
  </g>
</svg>\`)));

          return (
            <div className="min-h-screen flex flex-col p-3 bg-glez-dark selection:bg-glez-lime selection:text-black">
              {/* Header */}
              <header className="mb-4 flex items-center justify-between border-b border-white/10 pb-2">
                <div className="flex items-center gap-3">
                   {/* Logo Container */}
                   <div className="relative h-10 w-32">
                        <img 
                            src={logoSrc}
                            alt="The Glez" 
                            className="h-full w-full object-contain object-left"
                        />
                   </div>
                </div>
                <div className="flex items-center gap-2">
                     <div className="text-[9px] font-mono uppercase tracking-widest text-zinc-500 text-right leading-tight">
                        Plugin<br/>Toolkit
                     </div>
                     <button onClick={() => new window.CSInterface().openURLInDefaultBrowser('https://theglez.com')} className="p-1.5 rounded-full hover:bg-white/5 transition-colors text-zinc-500 hover:text-glez-lime"><InfoIcon size={16} /></button>
                </div>
              </header>

              {/* Grid - 3 Columns for smaller buttons */}
              <main className="flex-1 grid grid-cols-3 gap-2 content-start pb-2">
                {tools.map((tool) => {
                    const Icon = tool.icon;
                    return (
                      <button key={tool.id} onClick={() => runAeScript(tool.functionName)} onMouseEnter={() => setHoveredId(tool.id)} onMouseLeave={() => setHoveredId(null)}
                        className="group relative flex flex-col items-start p-2 rounded-lg border border-zinc-700/50 bg-glez-card transition-all duration-300 ease-out hover:border-glez-lime hover:shadow-[0_0_15px_rgba(204,255,0,0.1)] hover:-translate-y-0.5 h-24 overflow-hidden">
                        
                        <div className="flex items-start justify-between w-full mb-1">
                            <div className="p-1.5 rounded bg-zinc-800 transition-colors duration-300 group-hover:bg-glez-lime group-hover:text-black text-zinc-300">
                                <Icon size={18} />
                            </div>
                            <div className="opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-glez-lime">
                                <ZapIcon size={12} fill="currentColor" />
                            </div>
                        </div>

                        <div className="text-left z-10 w-full">
                            <h3 className="text-xs font-bold text-white group-hover:text-glez-lime transition-colors truncate">{tool.name}</h3>
                            <p className="text-[9px] text-zinc-400 mt-0.5 leading-tight line-clamp-2 opacity-80">{tool.description}</p>
                        </div>
                        
                        <div className="absolute inset-0 rounded-lg bg-gradient-to-br from-glez-lime/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none" />
                      </button>
                    );
                })}
              </main>

              {/* Footer */}
              <footer className="mt-auto pt-2 border-t border-white/5 text-center"><p className="text-[8px] text-zinc-600 uppercase tracking-widest">Designed for professional workflows</p></footer>
            </div>
          );
        };
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>`,

  "host/index.jsx": `// Clean Namespace Initialization
if (typeof $._TheGlez === 'undefined') {
    $._TheGlez = {};
}

// --- SUBTITLE PRO ---
$._TheGlez.runSubtitlePro = function() {
    var scriptName = "Subtitle Pro";
    
    function rgbToHex(r, g, b) { var toHex = function(c) { var hex = Math.round(c * 255).toString(16); return hex.length == 1 ? "0" + hex : hex; }; return toHex(r) + toHex(g) + toHex(b); }
    function hexToRgb(hex) { if (typeof hex !== 'string') return [1,1,1]; hex = hex.replace(/[^0-9A-Fa-f]/g, ""); if (hex.length === 3) hex = hex[0]+hex[0]+hex[1]+hex[1]+hex[2]+hex[2]; if (hex.length !== 6) return [1,1,1]; var r = parseInt(hex.substring(0,2), 16) / 255; var g = parseInt(hex.substring(2,4), 16) / 255; var b = parseInt(hex.substring(4,6), 16) / 255; return [r, g, b]; }
    function parseTime(str) { var parts = str.replace(',', '.').split(':'); if (parts.length < 3) return 0; return (parseInt(parts[0])*3600) + (parseInt(parts[1])*60) + parseFloat(parts[2]); }

    var win = new Window("palette", scriptName, undefined, {resizeable: true});
    win.orientation = "column"; win.alignChildren = ["fill", "top"]; win.spacing = 10; win.margins = 16;
    
    var headerGrp = win.add("group"); headerGrp.orientation = "row";
    var title = headerGrp.add("statictext", undefined, "SUBTITLE PRO");
    
    var pnlFile = win.add("panel", undefined, "SRT File"); pnlFile.orientation = "column"; pnlFile.alignChildren = ["fill", "top"]; pnlFile.margins = 12;
    var grpFileRow = pnlFile.add("group"); grpFileRow.orientation = "row";
    var btnLoad = grpFileRow.add("button", undefined, "Import .SRT"); btnLoad.size = [120, 30];
    var lblFile = grpFileRow.add("statictext", undefined, "No file...", {truncate: "middle"}); lblFile.size = [150, 20];

    var pnlStyle = win.add("panel", undefined, "Style"); pnlStyle.orientation = "column"; pnlStyle.alignChildren = ["fill", "top"]; pnlStyle.spacing = 10; pnlStyle.margins = 12;
    var grpColor = pnlStyle.add("group"); grpColor.orientation = "row"; grpColor.add("statictext", undefined, "Color:");
    var colorBtn = grpColor.add("button", [0,0,30,25], ""); var currentColor = [1, 1, 1];
    var inpHex = grpColor.add("edittext", undefined, "FFFFFF"); inpHex.characters = 6;
    
    colorBtn.onDraw = function() { var g = this.graphics; g.rectPath(0,0,this.size[0],this.size[1]); g.fillPath(g.newBrush(g.BrushType.SOLID_COLOR, currentColor)); g.strokePath(g.newPen(g.PenType.SOLID_COLOR, [0,0,0], 1)); }; 
    colorBtn.onClick = function() { var r = Math.round(currentColor[0] * 255); var g = Math.round(currentColor[1] * 255); var b = Math.round(currentColor[2] * 255); var colorInt = (r << 16) | (g << 8) | b; var result = $.colorPicker(colorInt); if (result !== -1) { var nr = ((result >> 16) & 0xFF) / 255; var ng = ((result >> 8) & 0xFF) / 255; var nb = (result & 0xFF) / 255; currentColor = [nr, ng, nb]; colorBtn.notify("onDraw"); inpHex.text = rgbToHex(nr, ng, nb).toUpperCase(); } };
    inpHex.onChange = function() { currentColor = hexToRgb(this.text); colorBtn.notify("onDraw"); };

    var grpTypo = pnlStyle.add("group"); grpTypo.orientation = "row"; grpTypo.add("statictext", undefined, "Size:"); var inpSize = grpTypo.add("edittext", undefined, "30"); inpSize.characters = 4; grpTypo.add("statictext", undefined, "Break:"); var inpBreak = grpTypo.add("edittext", undefined, "50"); inpBreak.characters = 4;
    var grpChecks = pnlStyle.add("group"); grpChecks.orientation = "row"; var chkCaps = grpChecks.add("checkbox", undefined, "UPPERCASE"); var chkStroke = grpChecks.add("checkbox", undefined, "Stroke");
    var pnlAnim = win.add("panel", undefined, "Animation"); pnlAnim.orientation = "column"; pnlAnim.alignChildren = ["fill", "top"]; var grpAnim = pnlAnim.add("group"); grpAnim.orientation = "row"; grpAnim.add("statictext", undefined, "Preset:"); var ddAnim = grpAnim.add("dropdownlist", undefined, ["Pop Up", "Fade In", "Slide Up", "Typewriter"]); ddAnim.selection = 0; var grpPos = pnlAnim.add("group"); grpPos.add("statictext", undefined, "Position Y:"); var sldPos = grpPos.add("slider", undefined, 92, 0, 100);

    var btnRun = win.add("button", undefined, "GENERATE SUBTITLES"); btnRun.size = [undefined, 45];
    var srtContent = "";
    btnLoad.onClick = function() { var f = File.openDialog("Select SRT File"); if (f) { f.open("r"); srtContent = f.read(); f.close(); lblFile.text = f.name; } };

    btnRun.onClick = function() {
        if (!srtContent) { alert("Import an SRT file first."); return; }
        app.beginUndoGroup("Subtitle Pro Gen");
        try {
            var comp = app.project.activeItem;
            if (!comp || !(comp instanceof CompItem)) comp = app.project.items.addComp("Subtitles Sequence", 1080, 1920, 1, 60, 30);
            var config = { size: parseInt(inpSize.text), color: currentColor, y: comp.height * (sldPos.value / 100), caps: chkCaps.value, stroke: chkStroke.value, wrap: parseInt(inpBreak.text), anim: ddAnim.selection ? ddAnim.selection.text : "Pop Up" };
            // FIX: Double escaped regex for ZXP file write safety
            var blocks = srtContent.replace(/\\r\\n/g, "\\n").split("\\n\\n");
            var wrapText = function(text, limit) { var words = text.split(" "); var lines = [], cur = ""; for (var i=0; i<words.length; i++) { if ((cur + words[i]).length > limit) { if(cur.length>0) lines.push(cur); cur = words[i] + " "; } else cur += words[i] + " "; } if(cur.length>0) lines.push(cur); return lines.join("\\r"); };
            
            for (var i=0; i<blocks.length; i++) {
                var lines = blocks[i].split("\\n");
                if (lines.length >= 3) {
                    var timePart = lines[1].split(" --> ");
                    if (timePart.length === 2) {
                        var rawTxt = lines.slice(2).join(" "); if (config.caps) rawTxt = rawTxt.toUpperCase(); var finalTxt = wrapText(rawTxt, config.wrap);
                        var l = comp.layers.addText(finalTxt); var doc = l.property("Source Text").value;
                        doc.fontSize = config.size; doc.fillColor = config.color; doc.justification = ParagraphJustification.CENTER_JUSTIFY;
                        if (config.stroke) { doc.applyStroke = true; doc.strokeColor = [0,0,0]; doc.strokeWidth = 10; }
                        l.property("Source Text").setValue(doc); l.property("Position").setValue([comp.width/2, config.y]);
                        l.inPoint = parseTime(timePart[0]); l.outPoint = parseTime(timePart[1]);
                        var st = l.inPoint;
                        
                        if (config.anim === "Pop Up") { l.property("Scale").setValueAtTime(st, [0,0]); l.property("Scale").setValueAtTime(st+0.15, [110,110]); l.property("Scale").setValueAtTime(st+0.25, [100,100]); }
                        else if (config.anim === "Fade In") { l.property("Opacity").setValueAtTime(st, 0); l.property("Opacity").setValueAtTime(st+0.3, 100); }
                        else if (config.anim === "Slide Up") { var p = l.property("Position").value; l.property("Position").setValueAtTime(st, [p[0], p[1]+100]); l.property("Position").setValueAtTime(st+0.3, p); l.property("Opacity").setValueAtTime(st, 0); l.property("Opacity").setValueAtTime(st+0.3, 100); }
                        else if (config.anim === "Typewriter") { var anim = l.Text.Animators.addProperty("ADBE Text Animator"); var op = anim.property("ADBE Text Animator Properties").addProperty("ADBE Text Opacity"); op.setValue(0); var sel = anim.property("ADBE Text Selectors").addProperty("ADBE Text Selector"); sel.property("Start").setValueAtTime(st, 0); sel.property("Start").setValueAtTime(st + (finalTxt.length * 0.05), 100); }
                    }
                }
            }
        } catch(e) { alert("Error: " + e.toString()); } finally { app.endUndoGroup(); }
    };
    win.center(); win.show();
}

// --- RESIZE COMP ---
$._TheGlez.runResizeComp = function() {
    if (!app || !app.project) { alert("No project open."); return; }
    var proj = app.project; var comp = proj.activeItem;
    if (!(comp instanceof CompItem)) { alert("Please select a composition."); return; }
    if (!comp.selectedLayers || comp.selectedLayers.length !== 1) { alert("Select ONE layer."); return; }
    var layer = comp.selectedLayers[0];
    
    function getBounds2D(lyr, time) {
        var rect; try { rect = lyr.sourceRectAtTime(time, false); } catch (e) { rect = null; }
        if (!rect) { var w = lyr.width || 0; var h = lyr.height || 0; rect = { left: 0, top: 0, width: w, height: h }; }
        var pos = lyr.property("Position").value; var anchor = lyr.property("Anchor Point").value; var scale = lyr.property("Scale").value;
        var sx = scale[0] / 100.0; var sy = scale[1] / 100.0;
        var compLeft = pos[0] + (rect.left - anchor[0]) * sx; var compTop = pos[1] + (rect.top - anchor[1]) * sy;
        return { minX: compLeft, maxX: compLeft + (rect.width * sx), minY: compTop, maxY: compTop + (rect.height * sy) };
    }
    
    var bounds = getBounds2D(layer, comp.time);
    var newWidth = Math.round(bounds.maxX - bounds.minX); var newHeight = Math.round(bounds.maxY - bounds.minY);
    if (newWidth < 1 || newHeight < 1) { alert("Layer too small."); return; }
    app.beginUndoGroup("Resize Comp - The Glez");
    var offsetX = bounds.minX; var offsetY = bounds.minY;
    for (var i = 1; i <= comp.numLayers; i++) {
        var lyr = comp.layer(i); var posProp = lyr.property("Position");
        if (posProp) { var pos = posProp.value; if (pos instanceof Array && pos.length >= 2) { pos[0] -= offsetX; pos[1] -= offsetY; posProp.setValue(pos); } }
    }
    comp.width = newWidth; comp.height = newHeight;
    app.endUndoGroup();
}

// --- UNUSED CLEANER ---
$._TheGlez.runUnusedCleaner = function() {
    if (!app || !app.project) return;
    var dlg = new Window("dialog", "Unused Cleaner"); dlg.orientation = "column"; dlg.alignChildren = "left"; dlg.margins = 12;
    dlg.add("statictext", undefined, "Plug-in By The Glez");
    var grpWhat = dlg.add("panel", undefined, "Targets"); grpWhat.orientation = "column"; grpWhat.alignChildren = "left";
    var chkPrecomps = grpWhat.add("checkbox", undefined, "Unused pre-comps"); chkPrecomps.value = true;
    var chkFootage = grpWhat.add("checkbox", undefined, "Unused footage"); chkFootage.value = true;
    var grpAction = dlg.add("panel", undefined, "Action"); grpAction.orientation = "column"; grpAction.alignChildren = "left";
    var rMove = grpAction.add("radiobutton", undefined, "Move to 04 - Others / _Unused"); rMove.value = true;
    var rDel = grpAction.add("radiobutton", undefined, "Delete from project");
    var grpButtons = dlg.add("group"); grpButtons.alignment = "right"; grpButtons.add("button", undefined, "OK", { name: "ok" }); grpButtons.add("button", undefined, "Cancel", { name: "cancel" });
    if (dlg.show() !== 1) return;

    var proj = app.project; var usedMap = {};
    for (var c = 1; c <= proj.numItems; c++) { var it = proj.item(c); if(it instanceof CompItem){ for(var l=1; l<=it.numLayers; l++){ try{var s=it.layer(l).source; if(s) usedMap[s.id]=true;}catch(e){} } } }
    function getOrCreateFolder(name, parent) { if(!parent) parent=proj.rootFolder; for(var i=1; i<=proj.numItems; i++){ var x=proj.item(i); if(x instanceof FolderItem && x.parentFolder===parent && x.name===name) return x;} var n=proj.items.addFolder(name); n.parentFolder=parent; return n; }
    
    app.beginUndoGroup("Clean Unused");
    var unusedFolder = rMove.value ? getOrCreateFolder("_Unused", getOrCreateFolder("04 - Others")) : null;
    var count = 0;
    var items = []; for(var i=1; i<=proj.numItems; i++) items.push(proj.item(i));
    for(var j=0; j<items.length; j++){
        var item=items[j]; if(item instanceof FolderItem) continue;
        var isUsed = !!usedMap[item.id];
        var process = false;
        if(chkPrecomps.value && item instanceof CompItem && !isUsed && item.parentFolder !== proj.rootFolder) process=true;
        if(chkFootage.value && !(item instanceof CompItem) && !isUsed) process=true;
        if(process){ if(rMove.value) item.parentFolder = unusedFolder; else try{item.remove();}catch(e){} count++; }
    }
    app.endUndoGroup(); alert("Processed " + count + " items.");
}

// --- RENAMER ---
$._TheGlez.runRenamer = function() {
    if (!app || !app.project) return;
    var comp = app.project.activeItem; if (!comp || !comp.selectedLayers || comp.selectedLayers.length === 0) { alert("Select layers."); return; }
    var dlg = new Window("dialog", "Renamer"); dlg.orientation = "column"; dlg.alignChildren = "left";
    dlg.add("statictext", undefined, "Plug-in By The Glez");
    var grpPrefix = dlg.add("group"); grpPrefix.add("statictext", undefined, "Prefix:"); var txtPrefix = grpPrefix.add("edittext", undefined, ""); txtPrefix.characters = 10;
    var grpBase = dlg.add("group"); grpBase.add("statictext", undefined, "Name:"); var txtBase = grpBase.add("edittext", undefined, ""); txtBase.characters = 10;
    var grpSuffix = dlg.add("group"); grpSuffix.add("statictext", undefined, "Suffix:"); var txtSuffix = grpSuffix.add("edittext", undefined, ""); txtSuffix.characters = 10;
    var chkNum = dlg.add("checkbox", undefined, "Numbering"); chkNum.value = true;
    var grpBtns = dlg.add("group"); grpBtns.add("button", undefined, "OK", {name:"ok"}); grpBtns.add("button", undefined, "Cancel", {name:"cancel"});
    if (dlg.show() !== 1) return;

    app.beginUndoGroup("Renamer");
    var layers = comp.selectedLayers;
    var sorted = []; for(var i=0; i<layers.length; i++) sorted.push(layers[i]);
    sorted.sort(function(a,b){ return a.index - b.index; });
    for(var i=0; i<sorted.length; i++){
        var name = ""; if(txtPrefix.text) name += txtPrefix.text; if(txtBase.text) name += txtBase.text;
        if(chkNum.value) { var n = (i+1).toString(); while(n.length<2) n="0"+n; name += n; }
        if(txtSuffix.text) name += txtSuffix.text;
        if(name !== "") sorted[i].name = name;
    }
    app.endUndoGroup();
}

// --- ORGANIZER ---
$._TheGlez.runOrganizer = function() {
    (function () {
        if (!app || !app.project) {
            alert("No project open.");
            return;
        }

        var proj       = app.project;
        var rootFolder = proj.rootFolder;

        // Collect all comps
        var compItems = [];
        for (var i = 1; i <= proj.numItems; i++) {
            var it = proj.item(i);
            if (it instanceof CompItem) {
                compItems.push(it);
            }
        }

        var keepUserFolders = true;
        var useMaster       = false;
        var masterComp      = null;
        var presetAdvanced  = false;

        if (compItems.length > 0) {
            var compNames = [];
            for (var c = 0; c < compItems.length; c++) {
                compNames.push(compItems[c].name);
            }

            var dlg = new Window("dialog", "Project Organizer");
            dlg.orientation   = "column";
            dlg.alignChildren = "left";
            dlg.margins       = 12;

            var headline = dlg.add("statictext", undefined, "Plug-in By The Glez");
            headline.characters = 30;

            dlg.add("statictext", undefined, "Choose how you want to organize the project:");

            var grpPreset = dlg.add("group");
            grpPreset.orientation = "row";
            grpPreset.add("statictext", undefined, "Preset:");
            var ddPreset = grpPreset.add("dropdownlist", undefined, ["Basic (default)", "Advanced (sequences + renders folder)"]);
            ddPreset.selection = 0;

            var grpKeep = dlg.add("group");
            grpKeep.orientation = "row";
            var chkKeep = grpKeep.add("checkbox", undefined, "Keep existing folders (donâ€™t move items inside them)");
            chkKeep.value = true;

            var grpMasterToggle = dlg.add("group");
            grpMasterToggle.orientation = "row";
            var chkMaster = grpMasterToggle.add("checkbox", undefined, "Use Master Comp (Output)");
            chkMaster.value = false;

            var grpComp = dlg.add("group");
            grpComp.orientation = "row";
            grpComp.add("statictext", undefined, "Master Comp:");
            var ddComp = grpComp.add("dropdownlist", undefined, compNames);
            ddComp.minimumSize.width = 260;
            ddComp.enabled = false;
            ddComp.selection = 0;

            chkMaster.onClick = function () {
                ddComp.enabled = chkMaster.value;
            };

            var grpButtons = dlg.add("group");
            grpButtons.alignment = "right";
            grpButtons.add("button", undefined, "OK",     { name: "ok" });
            grpButtons.add("button", undefined, "Cancel", { name: "cancel" });

            var res = dlg.show();
            if (res !== 1) {
                return; // cancelled
            }

            keepUserFolders = chkKeep.value;
            useMaster       = chkMaster.value;
            presetAdvanced  = (ddPreset.selection && ddPreset.selection.index === 1);

            if (useMaster && ddComp.selection) {
                masterComp = compItems[ddComp.selection.index];
            }

        } else {
            var cont = confirm("No compositions found in this project.\\n\\nDo you want to continue and just organize media by type?");
            if (!cont) return;
        }

        app.beginUndoGroup("Organize project by file type - The Glez");

        function getOrCreateFolder(name, parentFolder) {
            if (!parentFolder) parentFolder = rootFolder;
            for (var i = 1; i <= proj.numItems; i++) {
                var it = proj.item(i);
                if (it instanceof FolderItem && it.parentFolder === parentFolder && it.name === name) {
                    return it;
                }
            }
            var newFolder = proj.items.addFolder(name);
            newFolder.parentFolder = parentFolder;
            return newFolder;
        }

        var masterCompFolder = null;
        if (masterComp) {
            masterCompFolder = getOrCreateFolder("01 - Master Comp (Output)", rootFolder);
        }

        var preCompsFolder = getOrCreateFolder("02 - Pre-Comps", rootFolder);
        var footageRoot    = getOrCreateFolder("03 - Footage",   rootFolder);

        var imagesFolder   = getOrCreateFolder("3.1 - Images (Stills)", footageRoot);
        var videosFolder   = getOrCreateFolder("3.2 - Video",           footageRoot);
        var audioFolder    = getOrCreateFolder("3.3 - Audio",           footageRoot);
        var miscFootage    = getOrCreateFolder("3.4 - Misc",            footageRoot);

        var imgSeqFolder   = null;
        if (presetAdvanced) {
            imgSeqFolder = getOrCreateFolder("3.5 - Image Sequences", footageRoot);
        }

        var othersRoot     = getOrCreateFolder("04 - Others", rootFolder);
        var rendersRoot    = null;
        if (presetAdvanced) {
            rendersRoot = getOrCreateFolder("05 - Renders", rootFolder);
        }

        var specialFolders = [preCompsFolder, footageRoot, imagesFolder, videosFolder, audioFolder, miscFootage, othersRoot];
        if (masterCompFolder) specialFolders.push(masterCompFolder);
        if (imgSeqFolder) specialFolders.push(imgSeqFolder);
        if (rendersRoot) specialFolders.push(rendersRoot);

        function isSpecialFolder(item) {
            for (var i = 0; i < specialFolders.length; i++) {
                if (item === specialFolders[i]) return true;
            }
            return false;
        }

        var items = [];
        for (var i = 1; i <= proj.numItems; i++) {
            items.push(proj.item(i));
        }

        function getExtensionFromName(name) {
            name = name.toLowerCase();
            var dot = name.lastIndexOf(".");
            if (dot < 0 || dot === name.length - 1) return "";
            return name.substring(dot + 1);
        }

        function isImageSequenceName(name) {
            var lower = name.toLowerCase();
            var dot   = lower.lastIndexOf(".");
            if (dot < 0) return false;
            var base  = lower.substring(0, dot);
            var m = base.match(/(\d{3,6})$/);
            return m !== null;
        }

        var imageExts = { "jpg":1, "jpeg":1, "png":1, "tif":1, "tiff":1, "psd":1, "exr":1, "hdr":1, "tga":1, "bmp":1, "gif":1, "dpx":1, "cin":1, "webp":1 };
        var videoExts = { "mov":1, "mp4":1, "m4v":1, "avi":1, "mxf":1, "mkv":1, "mts":1, "m2ts":1, "wmv":1, "flv":1, "mpeg":1, "mpg":1 };
        var audioExts = { "wav":1, "aif":1, "aiff":1, "mp3":1, "m4a":1, "ogg":1 };

        for (var j = 0; j < items.length; j++) {
            var item = items[j];
            if (isSpecialFolder(item)) continue;
            if (keepUserFolders && item.parentFolder !== rootFolder) continue;
            if (masterComp && item === masterComp && masterCompFolder) {
                item.parentFolder = masterCompFolder;
                continue;
            }
            if (item instanceof FolderItem) continue;

            if (item instanceof CompItem) {
                item.parentFolder = preCompsFolder;
                continue;
            }

            var ext = getExtensionFromName(item.name);

            if (audioExts[ext]) {
                item.parentFolder = audioFolder;
                continue;
            }

            if (imageExts[ext]) {
                if (presetAdvanced && imgSeqFolder && isImageSequenceName(item.name)) {
                    item.parentFolder = imgSeqFolder;
                } else {
                    item.parentFolder = imagesFolder;
                }
                continue;
            }

            if (videoExts[ext]) {
                item.parentFolder = videosFolder;
                continue;
            }

            if (ext === "") {
                item.parentFolder = othersRoot;
            } else {
                item.parentFolder = miscFootage;
            }
        }

        app.endUndoGroup();

    })();
}

// --- AUTO COLOR ---
$._TheGlez.runAutoColor = function() {
    (function () {
        if (!app || !app.project) {
            alert("No project open.");
            return;
        }

        var proj = app.project;
        var comp = proj.activeItem;

        if (!(comp instanceof CompItem)) {
            alert("Please select a composition.");
            return;
        }

        if (!comp.selectedLayers || comp.selectedLayers.length === 0) {
            alert("Please select at least one layer in the active composition.");
            return;
        }

        var selLayers = comp.selectedLayers;

        // ------------------------------------------------
        // Label choices (AE default label set)
        // ------------------------------------------------
        var labelChoices = [
            { name: "No change", value: 0 },
            { name: "1 - Red",      value: 1 },
            { name: "2 - Yellow",   value: 2 },
            { name: "3 - Aqua",     value: 3 },
            { name: "4 - Pink",     value: 4 },
            { name: "5 - Lavender", value: 5 },
            { name: "6 - Peach",    value: 6 },
            { name: "7 - Seafoam",  value: 7 },
            { name: "8 - Blue",     value: 8 },
            { name: "9 - Green",    value: 9 },
            { name: "10 - Purple",  value: 10 },
            { name: "11 - Orange",  value: 11 },
            { name: "12 - Brown",   value: 12 },
            { name: "13 - Fuchsia", value: 13 },
            { name: "14 - Cyan",    value: 14 },
            { name: "15 - Sand",    value: 15 },
            { name: "16 - Smoke",   value: 16 }
        ];

        function createLabelDropdown(parent, label, defaultValue) {
            var g = parent.add("group");
            g.orientation = "row";
            g.add("statictext", undefined, label);

            var names = [];
            for (var i = 0; i < labelChoices.length; i++) {
                names.push(labelChoices[i].name);
            }

            var dd = g.add("dropdownlist", undefined, names);
            dd.minimumSize.width = 180;

            var defaultIndex = 0;
            for (var j = 0; j < labelChoices.length; j++) {
                if (labelChoices[j].value === defaultValue) {
                    defaultIndex = j;
                    break;
                }
            }
            dd.selection = defaultIndex;
            return dd;
        }

        // ------------------------------------------------
        // UI: Dialog
        // ------------------------------------------------
        var dlg = new Window("dialog", "Auto Type Color & Prefix");
        dlg.orientation   = "column";
        dlg.alignChildren = "left";
        dlg.margins       = 12;

        var headline = dlg.add("statictext", undefined, "Plug-in By The Glez");
        headline.characters = 30;

        dlg.add("statictext", undefined, "Choose label colors for each layer type:");

        var panelColors = dlg.add("panel", undefined, "Label colors by type");
        panelColors.orientation   = "column";
        panelColors.alignChildren = "left";
        panelColors.margins       = 10;

        var ddCam   = createLabelDropdown(panelColors, "Camera:",        4);  // Pink
        var ddLight = createLabelDropdown(panelColors, "Light:",         6);  // Peach
        var ddAud   = createLabelDropdown(panelColors, "Audio:",         7);  // Seafoam
        var ddPC    = createLabelDropdown(panelColors, "Pre-comp:",      15); // Sand (Composition)
        var ddVid   = createLabelDropdown(panelColors, "Footage Video:", 3);  // Aqua
        var ddImg   = createLabelDropdown(panelColors, "Footage Still:", 5);  // Lavender
        var ddTxt   = createLabelDropdown(panelColors, "Text:",          1);  // Red
        var ddShp   = createLabelDropdown(panelColors, "Shape:",         8);  // Blue
        var ddNull  = createLabelDropdown(panelColors, "Null:",          1);  // Red
        var ddAdj   = createLabelDropdown(panelColors, "Adjustment:",    5);  // Lavender
        var ddOth   = createLabelDropdown(panelColors, "Other:",         2);  // Yellow

        var panelOpts = dlg.add("panel", undefined, "Options");
        panelOpts.orientation   = "column";
        panelOpts.alignChildren = "left";
        panelOpts.margins       = 10;

        var grpPrefix = panelOpts.add("group");
        grpPrefix.orientation = "row";
        var chkAddPrefix = grpPrefix.add("checkbox", undefined, "Prepend type prefix to layer names");
        chkAddPrefix.value = true;

        var grpButtons = dlg.add("group");
        grpButtons.alignment = "right";
        grpButtons.add("button", undefined, "OK",     { name: "ok" });
        grpButtons.add("button", undefined, "Cancel", { name: "cancel" });

        var res = dlg.show();
        if (res !== 1) {
            return; // user cancelled
        }

        // ------------------------------------------------
        // Read label choices
        // ------------------------------------------------
        function getLabelFromDropdown(dd) {
            var idx = dd.selection ? dd.selection.index : 0;
            return labelChoices[idx].value;
        }

        var lblCam   = getLabelFromDropdown(ddCam);
        var lblLight = getLabelFromDropdown(ddLight);
        var lblAud   = getLabelFromDropdown(ddAud);
        var lblPC    = getLabelFromDropdown(ddPC);
        var lblVid   = getLabelFromDropdown(ddVid);
        var lblImg   = getLabelFromDropdown(ddImg);
        var lblTxt   = getLabelFromDropdown(ddTxt);
        var lblShp   = getLabelFromDropdown(ddShp);
        var lblNull  = getLabelFromDropdown(ddNull);
        var lblAdj   = getLabelFromDropdown(ddAdj);
        var lblOth   = getLabelFromDropdown(ddOth);

        var addPrefix = chkAddPrefix.value;

        // ------------------------------------------------
        // Prefix map
        // ------------------------------------------------
        var prefixMap = {
            camera:    "CAM - ",
            light:     "LGT - ",
            audio:     "AUD - ",
            precomp:   "PC - ",
            footVideo: "VID - ",
            footStill: "IMG - ",
            text:      "TXT - ",
            shape:     "SHP - ",
            "null":    "NULL - ",
            adjust:    "ADJ - ",
            other:     "OTH - "
        };

        // ------------------------------------------------
        // Helpers
        // ------------------------------------------------
        function isTextLayer(layer) {
            try {
                var st = layer.property("Source Text");
                return (st !== null && st !== undefined);
            } catch (e) {
                return false;
            }
        }

        function isShapeLayer(layer) {
            try {
                var grp = layer.property("ADBE Root Vectors Group");
                return (grp !== null && grp !== undefined);
            } catch (e) {
                return false;
            }
        }

        function isCameraLayer(layer) {
            try {
                if (layer instanceof CameraLayer) {
                    return true;
                }
            } catch (e) {
                try {
                    var camOpts = layer.property("ADBE Camera Options Group");
                    if (camOpts !== null && camOpts !== undefined) {
                        return true;
                    }
                } catch (e2) {}
            }
            return false;
        }

        function isLightLayer(layer) {
            try {
                if (layer instanceof LightLayer) {
                    return true;
                }
            } catch (e) {
                try {
                    var lgtOpts = layer.property("ADBE Light Options Group");
                    if (lgtOpts !== null && lgtOpts !== undefined) {
                        return true;
                    }
                } catch (e2) {}
            }
            return false;
        }

        function isAudioOnlyLayer(layer) {
            try {
                return (layer.hasAudio && !layer.hasVideo);
            } catch (e) {}
            return false;
        }

        function getSource(layer) {
            try {
                return layer.source;
            } catch (e) {
                return null;
            }
        }

        function isPrecompLayer(layer) {
            var src = getSource(layer);
            if (!src) return false;
            return (src instanceof CompItem);
        }

        function getExtensionFromName(name) {
            name = name.toLowerCase();
            var dot = name.lastIndexOf(".");
            if (dot < 0 || dot === name.length - 1) return "";
            return name.substring(dot + 1);
        }

        var imageExts = {
            "jpg":1, "jpeg":1, "png":1, "tif":1, "tiff":1,
            "psd":1, "exr":1, "hdr":1, "tga":1, "bmp":1,
            "gif":1, "dpx":1, "cin":1, "webp":1
        };

        var videoExts = {
            "mov":1, "mp4":1, "m4v":1, "avi":1, "mxf":1,
            "mkv":1, "mts":1, "m2ts":1, "wmv":1, "flv":1,
            "mpeg":1, "mpg":1
        };

        function classifyFootage(layer) {
            var src = getSource(layer);
            if (!src) return null;

            var name = src.name || layer.name;
            var ext  = getExtensionFromName(name);

            if (imageExts[ext]) return "footStill";
            if (videoExts[ext]) return "footVideo";

            return "footOther";
        }

        function startsWithPrefix(name, prefix) {
            if (!prefix || prefix === "") return false;
            if (!name) return false;
            if (name.length < prefix.length) return false;
            var start = name.substring(0, prefix.length);
            return start === prefix;
        }

        // ------------------------------------------------
        // Main logic
        // ------------------------------------------------
        app.beginUndoGroup("Auto Type Color & Prefix - The Glez");

        for (var k = 0; k < selLayers.length; k++) {
            var lyr = selLayers[k];

            var category = null;

            // Priority: camera, light, audio, text, shape, null, adjust, precomp, footage, other
            if (!category && isCameraLayer(lyr)) {
                category = "camera";
            }

            if (!category && isLightLayer(lyr)) {
                category = "light";
            }

            if (!category && isAudioOnlyLayer(lyr)) {
                category = "audio";
            }

            if (!category && isTextLayer(lyr)) {
                category = "text";
            }

            if (!category && isShapeLayer(lyr)) {
                category = "shape";
            }

            if (!category && lyr.nullLayer === true) {
                category = "null";
            }

            if (!category && lyr.adjustmentLayer === true) {
                category = "adjust";
            }

            if (!category && isPrecompLayer(lyr)) {
                category = "precomp";
            }

            if (!category) {
                var ftCat = classifyFootage(lyr);
                if (ftCat === "footVideo") {
                    category = "footVideo";
                } else if (ftCat === "footStill") {
                    category = "footStill";
                }
            }

            if (!category) {
                category = "other";
            }

            // Label por tipo
            var chosenLabel = 0;
            switch (category) {
                case "camera":    chosenLabel = lblCam;   break;
                case "light":     chosenLabel = lblLight; break;
                case "audio":     chosenLabel = lblAud;   break;
                case "precomp":   chosenLabel = lblPC;    break;
                case "footVideo": chosenLabel = lblVid;   break;
                case "footStill": chosenLabel = lblImg;   break;
                case "text":      chosenLabel = lblTxt;   break;
                case "shape":     chosenLabel = lblShp;   break;
                case "null":      chosenLabel = lblNull;  break;
                case "adjust":    chosenLabel = lblAdj;   break;
                case "other":     chosenLabel = lblOth;   break;
            }

            if (chosenLabel > 0) {
                lyr.label = chosenLabel;
            }

            // Prefixo
            if (addPrefix) {
                var prefix = prefixMap[category];
                if (prefix && prefix.length > 0) {
                    var originalName = lyr.name;
                    if (!startsWithPrefix(originalName, prefix)) {
                        lyr.name = prefix + originalName;
                    }
                }
            }
        }

        app.endUndoGroup();

    })();
}`
};